<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loan Ledger - M-pesewa</title>
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/dashboard.css">
    <link rel="stylesheet" href="../assets/css/forms.css">
    <link rel="stylesheet" href="../assets/css/tables.css">
    <link rel="stylesheet" href="../assets/css/animations.css">
    <link rel="manifest" href="../manifest.json">
    <link rel="icon" href="../assets/images/logo.svg" type="image/svg+xml">
    <meta name="theme-color" content="#0A65FC">
</head>
<body class="dashboard-page ledger-page">
    <header class="main-header">
        <div class="header-container">
            <div class="logo-section">
                <div class="logo-icon">‚Çµ</div>
                <h1 class="logo-text">M-pesewa<span>.com</span></h1>
            </div>
            <nav class="main-nav">
                <a href="../index.html" class="nav-link">Home</a>
                <a href="../pages/countries/index.html" class="nav-link">Countries</a>
                <a href="../pages/groups.html" class="nav-link">Groups</a>
                <a href="../pages/lending.html" class="nav-link">Lend</a>
                <a href="../pages/borrowing.html" class="nav-link">Borrow</a>
                <a href="../pages/ledger.html" class="nav-link active">Ledger</a>
                <a href="../pages/subscriptions.html" class="nav-link">Subscription</a>
            </nav>
            <div class="header-actions">
                <div class="user-menu">
                    <span class="user-avatar">L</span>
                    <span class="user-name">Ledger Manager</span>
                    <div class="dropdown-menu">
                        <a href="../pages/dashboard/lender-dashboard.html">Dashboard</a>
                        <a href="../pages/profile.html">Profile</a>
                        <a href="../pages/settings.html">Settings</a>
                        <a href="../index.html" class="logout">Logout</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="dashboard-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h3>Loan Ledger System</h3>
                <div class="ledger-count">24 Ledgers</div>
            </div>
            <nav class="sidebar-nav">
                <a href="#all-ledgers" class="sidebar-link active">
                    <span class="icon">üìí</span>
                    <span>All Ledgers</span>
                </a>
                <a href="#active" class="sidebar-link">
                    <span class="icon">üí∞</span>
                    <span>Active Loans</span>
                </a>
                <a href="#overdue" class="sidebar-link">
                    <span class="icon">‚ö†Ô∏è</span>
                    <span>Overdue</span>
                </a>
                <a href="#cleared" class="sidebar-link">
                    <span class="icon">‚úÖ</span>
                    <span>Cleared</span>
                </a>
                <a href="#create" class="sidebar-link">
                    <span class="icon">‚ûï</span>
                    <span>Create New</span>
                </a>
                <a href="#reports" class="sidebar-link">
                    <span class="icon">üìä</span>
                    <span>Reports</span>
                </a>
                <a href="#settings" class="sidebar-link">
                    <span class="icon">‚öôÔ∏è</span>
                    <span>Ledger Settings</span>
                </a>
            </nav>
            <div class="sidebar-footer">
                <div class="ledger-stats">
                    <div class="stat-item">
                        <div class="stat-label">Total Value</div>
                        <div class="stat-value">‚Çµ89,400</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Active</div>
                        <div class="stat-value">12</div>
                    </div>
                </div>
            </div>
        </aside>

        <main class="main-content">
            <div class="dashboard-header">
                <div class="header-left">
                    <h2>Loan Ledger Management</h2>
                    <p>Track, update, and manage all borrower loan records. Unlimited ledgers per lender.</p>
                </div>
                <div class="header-right">
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="exportLedgers()">
                            <span class="icon">üì•</span>
                            Export All
                        </button>
                        <button class="btn btn-outline" onclick="printLedger()">
                            <span class="icon">üñ®Ô∏è</span>
                            Print
                        </button>
                        <div class="search-box">
                            <input type="text" placeholder="Search ledgers..." id="ledgerSearch">
                            <button class="search-btn">üîç</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="dashboard-sections">
                <!-- All Ledgers Section -->
                <section id="all-ledgers" class="dashboard-section active">
                    <div class="section-header">
                        <h3>All Loan Ledgers</h3>
                        <div class="section-filters">
                            <div class="filter-group">
                                <label>Filter by:</label>
                                <select id="ledgerFilter">
                                    <option value="all">All Status</option>
                                    <option value="active">Active</option>
                                    <option value="overdue">Overdue</option>
                                    <option value="cleared">Cleared</option>
                                    <option value="default">Default</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Sort by:</label>
                                <select id="ledgerSort">
                                    <option value="due">Due Date</option>
                                    <option value="amount">Amount</option>
                                    <option value="borrower">Borrower</option>
                                    <option value="category">Category</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="ledgers-summary">
                        <div class="summary-card">
                            <div class="summary-icon">üí∞</div>
                            <div class="summary-content">
                                <div class="summary-value">‚Çµ89,400</div>
                                <div class="summary-label">Total Loan Value</div>
                            </div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-icon">‚è∞</div>
                            <div class="summary-content">
                                <div class="summary-value">‚Çµ8,940</div>
                                <div class="summary-label">Expected Interest</div>
                            </div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-icon">‚ö†Ô∏è</div>
                            <div class="summary-content">
                                <div class="summary-value">‚Çµ1,200</div>
                                <div class="summary-label">Penalties Due</div>
                            </div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-icon">‚úÖ</div>
                            <div class="summary-content">
                                <div class="summary-value">12/24</div>
                                <div class="summary-label">Active/Cleared</div>
                            </div>
                        </div>
                    </div>

                    <div class="ledgers-table-container">
                        <table class="ledgers-table">
                            <thead>
                                <tr>
                                    <th>Borrower</th>
                                    <th>Category</th>
                                    <th>Amount</th>
                                    <th>Date Borrowed</th>
                                    <th>Due Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="ledger-row active">
                                    <td>
                                        <div class="borrower-info">
                                            <div class="borrower-avatar">J</div>
                                            <div class="borrower-details">
                                                <strong>John Kimani</strong>
                                                <div class="borrower-contact">+254 712 345 678</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="category-tag transport">Transport</div>
                                    </td>
                                    <td>
                                        <div class="amount-display">
                                            <div class="principal">‚Çµ5,000</div>
                                            <div class="interest">+‚Çµ500 (10%)</div>
                                        </div>
                                    </td>
                                    <td>2024-01-15</td>
                                    <td>
                                        <div class="due-date">
                                            <div>2024-01-22</div>
                                            <div class="days-left">3 days left</div>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="status-badge active">Active</span>
                                    </td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="btn-action" onclick="viewLedger(1)">View</button>
                                            <button class="btn-action" onclick="updateLedger(1)">Update</button>
                                        </div>
                                    </td>
                                </tr>
                                
                                <tr class="ledger-row active">
                                    <td>
                                        <div class="borrower-info">
                                            <div class="borrower-avatar">S</div>
                                            <div class="borrower-details">
                                                <strong>Sarah Mwangi</strong>
                                                <div class="borrower-contact">+254 723 456 789</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="category-tag medicine">Medicine</div>
                                    </td>
                                    <td>
                                        <div class="amount-display">
                                            <div class="principal">‚Çµ3,500</div>
                                            <div class="interest">+‚Çµ350 (10%)</div>
                                        </div>
                                    </td>
                                    <td>2024-01-17</td>
                                    <td>
                                        <div class="due-date">
                                            <div>2024-01-24</div>
                                            <div class="days-left">5 days left</div>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="status-badge active">Active</span>
                                    </td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="btn-action" onclick="viewLedger(2)">View</button>
                                            <button class="btn-action" onclick="updateLedger(2)">Update</button>
                                        </div>
                                    </td>
                                </tr>
                                
                                <tr class="ledger-row overdue">
                                    <td>
                                        <div class="borrower-info">
                                            <div class="borrower-avatar">P</div>
                                            <div class="borrower-details">
                                                <strong>Peter Ochieng</strong>
                                                <div class="borrower-contact">+254 734 567 890</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="category-tag school">School Fees</div>
                                    </td>
                                    <td>
                                        <div class="amount-display">
                                            <div class="principal">‚Çµ7,200</div>
                                            <div class="interest overdue">+‚Çµ1,080 (15%)</div>
                                        </div>
                                    </td>
                                    <td>2024-01-05</td>
                                    <td>
                                        <div class="due-date overdue">
                                            <div>2024-01-12</div>
                                            <div class="days-overdue">3 days overdue</div>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="status-badge overdue">Overdue</span>
                                    </td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="btn-action" onclick="viewLedger(3)">View</button>
                                            <button class="btn-action warning" onclick="addPenalty(3)">Add Penalty</button>
                                        </div>
                                    </td>
                                </tr>
                                
                                <tr class="ledger-row cleared">
                                    <td>
                                        <div class="borrower-info">
                                            <div class="borrower-avatar">M</div>
                                            <div class="borrower-details">
                                                <strong>Mary Wanjiku</strong>
                                                <div class="borrower-contact">+254 745 678 901</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="category-tag food">Food</div>
                                    </td>
                                    <td>
                                        <div class="amount-display">
                                            <div class="principal">‚Çµ2,000</div>
                                            <div class="interest cleared">+‚Çµ200 (10%)</div>
                                        </div>
                                    </td>
                                    <td>2024-01-03</td>
                                    <td>
                                        <div class="due-date cleared">
                                            <div>2024-01-10</div>
                                            <div class="status-text">Cleared</div>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="status-badge cleared">Cleared</span>
                                    </td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="btn-action" onclick="viewLedger(4)">View</button>
                                            <button class="btn-action" onclick="rateBorrower(4)">Rate</button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <div class="table-footer">
                            <div class="pagination">
                                <button class="page-btn" disabled>‚Üê Previous</button>
                                <span class="page-info">Page 1 of 3</span>
                                <button class="page-btn">Next ‚Üí</button>
                            </div>
                            <div class="table-stats">
                                Showing 4 of 24 ledgers
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Active Loans Section -->
                <section id="active" class="dashboard-section">
                    <div class="section-header">
                        <h3>Active Loan Ledgers</h3>
                        <p>Manage currently active loans. Update repayments and track progress.</p>
                    </div>
                    
                    <div class="active-ledgers-grid">
                        <!-- Active ledger cards will be populated by JavaScript -->
                        <div class="ledger-card active">
                            <div class="card-header">
                                <div class="borrower-info">
                                    <div class="avatar">J</div>
                                    <div class="details">
                                        <h4>John Kimani</h4>
                                        <div class="rating">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ 4.2</div>
                                    </div>
                                </div>
                                <div class="amount">‚Çµ5,500</div>
                            </div>
                            <div class="card-details">
                                <div class="detail-item">
                                    <span>Category:</span>
                                    <span class="category transport">Transport</span>
                                </div>
                                <div class="detail-item">
                                    <span>Due Date:</span>
                                    <span class="due-date">2024-01-22</span>
                                </div>
                                <div class="detail-item">
                                    <span>Days Left:</span>
                                    <span class="days-left">3 days</span>
                                </div>
                                <div class="detail-item">
                                    <span>Daily Payment:</span>
                                    <span class="daily">‚Çµ786</span>
                                </div>
                            </div>
                            <div class="progress-section">
                                <div class="progress-label">
                                    <span>Repayment Progress</span>
                                    <span>0%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="card-actions">
                                <button class="btn btn-primary" onclick="recordPayment(1)">Record Payment</button>
                                <button class="btn btn-outline" onclick="viewDetails(1)">Details</button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Overdue Section -->
                <section id="overdue" class="dashboard-section">
                    <div class="section-header">
                        <h3>Overdue Loans & Penalties</h3>
                        <p>Manage overdue loans and apply 5% daily penalties after 7 days.</p>
                    </div>
                    
                    <div class="overdue-alert">
                        <div class="alert-icon">‚ö†Ô∏è</div>
                        <div class="alert-content">
                            <h4>Penalty Rules Applied</h4>
                            <p>Loans overdue for more than 7 days incur 5% daily penalty on remaining balance. After 2 months, loans enter DEFAULT status.</p>
                        </div>
                    </div>
                    
                    <div class="overdue-ledgers">
                        <div class="overdue-card">
                            <div class="card-header">
                                <div class="borrower-info">
                                    <div class="avatar">P</div>
                                    <div class="details">
                                        <h4>Peter Ochieng</h4>
                                        <div class="rating">‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ 3.5</div>
                                    </div>
                                </div>
                                <div class="overdue-badge">3 Days Overdue</div>
                            </div>
                            <div class="card-details">
                                <div class="detail-row">
                                    <span>Original Amount:</span>
                                    <span>‚Çµ7,200</span>
                                </div>
                                <div class="detail-row">
                                    <span>Interest (10%):</span>
                                    <span>‚Çµ720</span>
                                </div>
                                <div class="detail-row penalty">
                                    <span>Penalty (5% daily):</span>
                                    <span>‚Çµ360 (3 days)</span>
                                </div>
                                <div class="detail-row total">
                                    <span>Total Due:</span>
                                    <span>‚Çµ8,280</span>
                                </div>
                            </div>
                            <div class="penalty-breakdown">
                                <h5>Penalty Calculation</h5>
                                <div class="breakdown-item">
                                    <span>Day 1:</span>
                                    <span>‚Çµ7,920 √ó 5% = ‚Çµ396</span>
                                </div>
                                <div class="breakdown-item">
                                    <span>Day 2:</span>
                                    <span>‚Çµ8,316 √ó 5% = ‚Çµ416</span>
                                </div>
                                <div class="breakdown-item">
                                    <span>Day 3:</span>
                                    <span>‚Çµ8,732 √ó 5% = ‚Çµ437</span>
                                </div>
                            </div>
                            <div class="card-actions">
                                <button class="btn btn-danger" onclick="initiateCollection(3)">Start Collection</button>
                                <button class="btn btn-outline" onclick="contactGuarantors(3)">Contact Guarantors</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="blacklist-section">
                        <h4>Default & Blacklist Management</h4>
                        <div class="blacklist-info">
                            <p>Loans overdue for 2 months enter DEFAULT status. You can blacklist defaulters, which prevents them from new loans and groups.</p>
                            <div class="blacklist-actions">
                                <button class="btn btn-danger" onclick="blacklistBorrower(3)">Blacklist This Borrower</button>
                                <a href="../pages/blacklist.html" class="btn btn-outline">View Blacklist</a>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Create New Ledger Section -->
                <section id="create" class="dashboard-section">
                    <div class="section-header">
                        <h3>Create New Loan Ledger</h3>
                        <p>Create a ledger for a new loan approval. Ledger auto-generates after loan approval.</p>
                    </div>
                    
                    <form class="create-ledger-form" id="createLedgerForm">
                        <div class="form-sections">
                            <div class="form-section">
                                <h4>Borrower Information</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="newBorrowerName">Borrower Full Name *</label>
                                        <input type="text" id="newBorrowerName" required placeholder="Enter borrower's full name">
                                    </div>
                                    <div class="form-group">
                                        <label for="newBorrowerPhone">Phone Number *</label>
                                        <input type="tel" id="newBorrowerPhone" required placeholder="+254712345678">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="newBorrowerLocation">Location *</label>
                                    <input type="text" id="newBorrowerLocation" required placeholder="City, Town, or Village">
                                </div>
                            </div>
                            
                            <div class="form-section">
                                <h4>Guarantors Information</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="guarantor1Name">Guarantor 1 Name *</label>
                                        <input type="text" id="guarantor1Name" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="guarantor1Phone">Guarantor 1 Phone *</label>
                                        <input type="tel" id="guarantor1Phone" required>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="guarantor2Name">Guarantor 2 Name *</label>
                                        <input type="text" id="guarantor2Name" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="guarantor2Phone">Guarantor 2 Phone *</label>
                                        <input type="tel" id="guarantor2Phone" required>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-section">
                                <h4>Loan Details</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="loanCategory">Loan Category *</label>
                                        <select id="loanCategory" required>
                                            <option value="">Select category</option>
                                            <option value="transport">M-pesewa Fare (Transport)</option>
                                            <option value="data">M-pesewa Data</option>
                                            <option value="gas">M-pesewa Cooking Gas</option>
                                            <option value="food">M-pesewa Food</option>
                                            <option value="advance">M-pesewa Advance</option>
                                            <option value="wifi">M-pesewa Wifi</option>
                                            <option value="repair">M-pesewa Credo</option>
                                            <option value="water">M-pesewa Water Bill</option>
                                            <option value="fuel">M-pesewa Fuel</option>
                                            <option value="vehicle-repair">M-pesewa Repair</option>
                                            <option value="medicine">M-pesewa Medicine</option>
                                            <option value="electricity">M-pesewa Electricity</option>
                                            <option value="school">M-pesewa School Fees</option>
                                            <option value="tv">M-pesewa TV Subscription</option>
                                            <option value="sales">M-Pesa Daily Sales</option>
                                            <option value="capital">M-Pesa Working Capital</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="loanAmount">Loan Amount (‚Çµ) *</label>
                                        <input type="number" id="loanAmount" required min="100" max="5000" step="100">
                                        <div class="input-hint">Your Premium tier limit: ‚Çµ5,000 per week</div>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="disbursementDate">Disbursement Date *</label>
                                        <input type="date" id="disbursementDate" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="dueDate">Due Date *</label>
                                        <input type="date" id="dueDate" required>
                                        <div class="input-hint">Maximum 7 days from disbursement</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-section">
                                <h4>Terms & Conditions</h4>
                                <div class="terms-box">
                                    <div class="term-item">
                                        <input type="checkbox" id="term1" required>
                                        <label for="term1">I confirm loan disbursement was made off-platform via M-Pesa/Till/Bank</label>
                                    </div>
                                    <div class="term-item">
                                        <input type="checkbox" id="term2" required>
                                        <label for="term2">I agree to 10% weekly interest rate (7 days max)</label>
                                    </div>
                                    <div class="term-item">
                                        <input type="checkbox" id="term3" required>
                                        <label for="term3">I will apply 5% daily penalty for loans overdue beyond 7 days</label>
                                    </div>
                                    <div class="term-item">
                                        <input type="checkbox" id="term4" required>
                                        <label for="term4">I understand I can blacklist borrowers after 2 months default</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-outline" onclick="previewLedger()">Preview</button>
                                <button type="submit" class="btn btn-primary">Create Ledger</button>
                            </div>
                        </div>
                        
                        <div class="ledger-preview" id="ledgerPreview" style="display: none;">
                            <h4>Ledger Preview</h4>
                            <div class="preview-content">
                                <div class="preview-section">
                                    <h5>Borrower Details</h5>
                                    <div class="preview-item">
                                        <span>Name:</span>
                                        <span id="previewName">-</span>
                                    </div>
                                    <div class="preview-item">
                                        <span>Phone:</span>
                                        <span id="previewPhone">-</span>
                                    </div>
                                    <div class="preview-item">
                                        <span>Location:</span>
                                        <span id="previewLocation">-</span>
                                    </div>
                                </div>
                                <div class="preview-section">
                                    <h5>Loan Details</h5>
                                    <div class="preview-item">
                                        <span>Category:</span>
                                        <span id="previewCategory">-</span>
                                    </div>
                                    <div class="preview-item">
                                        <span>Amount:</span>
                                        <span id="previewAmount">-</span>
                                    </div>
                                    <div class="preview-item">
                                        <span>Interest (10%):</span>
                                        <span id="previewInterest">-</span>
                                    </div>
                                    <div class="preview-item">
                                        <span>Total Due:</span>
                                        <span id="previewTotal">-</span>
                                    </div>
                                    <div class="preview-item">
                                        <span>Due Date:</span>
                                        <span id="previewDueDate">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </section>

                <!-- Reports Section -->
                <section id="reports" class="dashboard-section">
                    <div class="section-header">
                        <h3>Ledger Reports & Analytics</h3>
                        <p>Generate reports and analyze lending performance</p>
                    </div>
                    
                    <div class="reports-grid">
                        <div class="report-card">
                            <div class="report-header">
                                <h4>Monthly Summary</h4>
                                <button class="btn-download" onclick="downloadReport('monthly')">üì•</button>
                            </div>
                            <div class="report-content">
                                <div class="report-item">
                                    <span>Total Lent This Month:</span>
                                    <span>‚Çµ25,400</span>
                                </div>
                                <div class="report-item">
                                    <span>Interest Earned:</span>
                                    <span>‚Çµ2,540</span>
                                </div>
                                <div class="report-item">
                                    <span>New Ledgers:</span>
                                    <span>8</span>
                                </div>
                                <div class="report-item">
                                    <span>Cleared Loans:</span>
                                    <span>5</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="report-card">
                            <div class="report-header">
                                <h4>Category Breakdown</h4>
                                <button class="btn-download" onclick="downloadReport('category')">üì•</button>
                            </div>
                            <div class="report-content">
                                <div class="report-item">
                                    <span>Transport:</span>
                                    <span>‚Çµ15,200 (35%)</span>
                                </div>
                                <div class="report-item">
                                    <span>School Fees:</span>
                                    <span>‚Çµ10,800 (25%)</span>
                                </div>
                                <div class="report-item">
                                    <span>Medicine:</span>
                                    <span>‚Çµ8,500 (20%)</span>
                                </div>
                                <div class="report-item">
                                    <span>Other:</span>
                                    <span>‚Çµ8,900 (20%)</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="report-card">
                            <div class="report-header">
                                <h4>Risk Analysis</h4>
                                <button class="btn-download" onclick="downloadReport('risk')">üì•</button>
                            </div>
                            <div class="report-content">
                                <div class="report-item">
                                    <span>Overdue Rate:</span>
                                    <span class="risk-low">4.2%</span>
                                </div>
                                <div class="report-item">
                                    <span>Default Risk:</span>
                                    <span class="risk-low">1.8%</span>
                                </div>
                                <div class="report-item">
                                    <span>Avg. Borrower Rating:</span>
                                    <span>4.1 ‚òÖ</span>
                                </div>
                                <div class="report-item">
                                    <span>Collection Success:</span>
                                    <span>96%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="report-generator">
                        <h4>Generate Custom Report</h4>
                        <form class="report-form" id="reportForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="reportType">Report Type</label>
                                    <select id="reportType">
                                        <option value="ledgers">Ledger Summary</option>
                                        <option value="repayments">Repayment Analysis</option>
                                        <option value="borrowers">Borrower Performance</option>
                                        <option value="categories">Category Performance</option>
                                        <option value="risk">Risk Assessment</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="reportPeriod">Time Period</label>
                                    <select id="reportPeriod">
                                        <option value="month">This Month</option>
                                        <option value="quarter">Last 3 Months</option>
                                        <option value="year">This Year</option>
                                        <option value="custom">Custom Range</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row" id="customRange" style="display: none;">
                                <div class="form-group">
                                    <label for="startDate">Start Date</label>
                                    <input type="date" id="startDate">
                                </div>
                                <div class="form-group">
                                    <label for="endDate">End Date</label>
                                    <input type="date" id="endDate">
                                </div>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">Generate Report</button>
                                <button type="button" class="btn btn-outline" onclick="printReport()">Print</button>
                            </div>
                        </form>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <footer class="main-footer">
        <div class="footer-container">
            <div class="footer-copyright">
                <p>&copy; 2024 M-pesewa. Emergency Micro-Lending in Trusted Circles.</p>
                <p>Ledger system: Unlimited ledgers per lender. Manual updates with admin override capability.</p>
            </div>
            <div class="footer-links">
                <a href="../pages/contact.html">Contact Support</a>
                <a href="../pages/qa.html">Q&A</a>
                <a href="../pages/admin.html">Admin Override</a>
                <a href="../pages/terms.html">Terms</a>
            </div>
        </div>
    </footer>

    <script src="../assets/js/ledger.js"></script>
    <script src="../assets/js/calculator.js"></script>
    <script src="../assets/js/utils.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            initializeLedgerPage();
            setupLedgerFilters();
        });
    </script>
</body>
</html>